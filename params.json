{"name":"Restfullyii","tagline":"Adds RESTFull API to your Yii application","body":"# _Starship / RestfullYii_\r\n\r\nMakes quickly adding a RESTFul API to your Yii project easy. RestfullYii provides full HTTP verb support (GET, PUT, POST, DELETE) for your resources, as well as the ability to offset, limit, sort, filter, etcâ€¦ . You will also have the ability to read and manipulate related data with ease.\r\n\r\nRestfullYii has been lovingly rebuilt from the metal and is now 100% test covered! The new event based architecture allows for clean and unlimited customization.\r\n\r\n## How it works\r\nRestfullYii adds a new set of RESTFul routes to your standard routes, but prepends '/api' .\r\n\r\nSo if you apply RestfullYii to the 'WorkController' you will get the following new routes by default.\r\n\r\n```\r\n[GET] http://yoursite.com/api/work (returns all works)\r\n[GET] http://yoursite.com/api/work/1 (returns work with PK=1)\r\n[POST] http://yoursite.com/api/work (create new work)\r\n[PUT] http://yoursite.com/api/work/1 (update work with PK=1)\r\n[DELETE] http://yoursite.com/api/work/1 (delete work with PK=1)\r\n```\r\n\r\n\r\n## Requirements\r\n\r\n* PHP 5.4.0 (or later)*\r\n* YiiFramework 1.1.14 (or later)\r\n* PHPUnit 3.7 (or later) to run tests.\r\n\r\n\r\n\r\n _For older versions of PHP (< 5.4) checkout [v1.15](https://github.com/evan108108/RESTFullYii/tree/v1.15)_\r\n\r\n## Installation\r\n1. Download and place the 'starship' directory in your Yii extension directory.\r\n\r\n2. Include ext.starship.RestfullYii.config.routes in your main config (see below) or copy the routes and paste them in your components->urlManager->rules in same config.  \r\n```php\r\n'components'=>array(\r\n\t\t'urlManager'=>array(\r\n\t\t\t'urlFormat'=>'path',\r\n\t\t\t'rules'=>require(\r\n\t\t\t\tdirname(__FILE__).'/../extensions/starship/restfullyii/config/routes.php'\r\n\t\t\t),\r\n\t\t),\r\n)\r\n```\r\n\r\n##Controller Setup\r\nAdding a set of RESTFul actions to a controller.\r\n\r\n1. Add the ERestFilter to your controllers filter method.\r\n```php\r\npublic function filters()\r\n{\r\n\t\treturn array(\r\n\t\t\t'accessControl', // perform access control for CRUD operations\r\n\t\t\tarray(\r\n\t\t\t\t'ext.starship.RestfullYii.filters.ERestFilter + \r\n\t\t\t \tREST.GET, REST.PUT, REST.POST, REST.DELETE'\r\n\t\t\t),\r\n\t\t);\r\n}\r\n```\r\n\r\n2. Add the ERestActionProvider to your controllers actions method.\r\n```php\r\npublic function actions()\r\n{\r\n\t\treturn array(\r\n\t\t\t'REST.'=>'ext.starship.RestfullYii.actions.ERestActionProvider',\r\n\t\t);\r\n}\t\r\n```\r\n\r\n3. If you are using the accessControl filter you need to make sure that access is allowed on all RESTFul routes.\r\n```php\r\npublic function accessRules()\r\n{\r\n\t\treturn array(\r\n\t\t\tarray('allow', 'actions'=>array('REST.GET', 'REST.PUT', 'REST.POST', 'REST.DELETE'),\r\n\t\t\t'users'=>array('*'),\r\n\t\t\t),\r\n\t\t\tarray('deny',  // deny all users\r\n\t\t\t\t'users'=>array('*'),\r\n\t\t\t),\r\n\t\t);\r\n}\r\n```\r\n\r\n## Making Requests\r\nTo understand how to make RestfullYii API requests its best to look at a few examples. Code examples will be shown first in JavaScript* as an AJAX user* and then using CURL.  \r\n\r\n_* JS examples use jQuery_\r\n\r\n_* Default validation for an AJAX user is !Yii::app()->user->isGuest so the user must be logged in for this type of request._\r\n\r\n###GET Requests\r\n\r\n#### Getting a list or resources (WorkController)\r\n\r\nJavaScript:\r\n```javascript\r\n $.ajax({\r\n    url:'/api/work',\r\n    type:\"GET\",\r\n    success:function(data) {\r\n      console.log(data);\r\n    },\r\n    error:function (xhr, ajaxOptions, thrownError){\r\n      console.log(xhr.responseText);\r\n    } \r\n  }); \r\n```\r\n\r\nCURL:\r\n```shell\r\ncurl -i -H \"Accept: application/json\" -H \"X_REST_USERNAME: admin@restuser\" -H \"X_REST_PASSWORD: admin@Access\"\\ \r\nhttp://my-site.com/api/work\r\n```\r\n\r\nResponse:\r\n```json\r\n{\r\n\t\"success\":true,\r\n\t\"message\":\"Record(s) Found\",\r\n\t\"data\":{\r\n\t\t\"totalCount\":\"30\",\r\n\t\t\"work\":[\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"1\",\r\n                \"title\": \"title1\",\r\n\t\t\t\t\"author_id\": \"1\",\r\n                \"content\": \"content1\",\r\n                \"create_time\": \"2013-08-07 10:09:41\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"2\",\r\n                \"title\": \"title2\",\r\n\t\t\t\t\"author_id\": \"2\",\r\n                \"content\": \"content2\",\r\n                \"create_time\": \"2013-08-08 11:01:11\"\r\n\t\t\t},\r\n\t\t\t. . .,\r\n\t\t]\r\n\t}\r\n}\t\r\n\r\n```\r\n\r\n#### Getting a single resource (WorkController)\r\n\r\nJavaScript:\r\n```javascript\r\n $.ajax({\r\n    url:'/api/work/1',\r\n    type:\"GET\",\r\n    success:function(data) {\r\n      console.log(data);\r\n    },\r\n    error:function (xhr, ajaxOptions, thrownError){\r\n      console.log(xhr.responseText);\r\n    } \r\n  }); \r\n```\r\n\r\n\r\nCURL:\r\n```shell\r\ncurl -i -H \"Accept: application/json\" -H \"X_REST_USERNAME: admin@restuser\" -H \"X_REST_PASSWORD: admin@Access\"\\\r\nhttp://my-site.com/api/work/1\r\n```\r\n\r\nResponse:\r\n```json\r\n{\r\n\t\"success\":true,\r\n\t\"message\":\"Record Found\",\r\n\t\"data\":{\r\n\t\t\"totalCount\":\"1\",\r\n\t\t\"work\":[\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"1\",\r\n                \"title\": \"title1\",\r\n\t\t\t\t\"author_id\": \"1\",\r\n                \"content\": \"content1\",\r\n                \"create_time\": \"2013-08-07 10:09:41\"\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n}\t\r\n```\r\n\r\n### GET Request: Limit & Offset (WorkController)\r\n\r\nYou can limit and paginate through your results by adding the limit and offset variables to the request query string.\r\n\r\nJavaScript:\r\n```javascript\r\n $.ajax({\r\n    url:'/api/work?limit=10&offset=30',\r\n    type:\"GET\",\r\n    success:function(data) {\r\n      console.log(data);\r\n    },\r\n    error:function (xhr, ajaxOptions, thrownError){\r\n      console.log(xhr.responseText);\r\n    } \r\n  }); \r\n```\r\n\r\nCURL:\r\n```shell\r\ncurl -i -H \"Accept: application/json\" -H \"X_REST_USERNAME: admin@restuser\" -H \"X_REST_PASSWORD: admin@Access\"\\\r\nhttp://my-site.com/api/work?limit=10&offset=30\r\n```\r\n\r\nResponse:\r\n```json\r\n{\r\n\t\"success\":true,\r\n\t\"message\":\"Record(s) Found\",\r\n\t\"data\":{\r\n\t\t\"totalCount\":\"30\",\r\n\t\t\"work\":[\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"11\",\r\n                \"title\": \"title11\",\r\n\t\t\t\t\"author_id\": \"11\",\r\n                \"content\": \"content11\",\r\n                \"create_time\": \"2013-08-11 11:10:09\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"12\",\r\n                \"title\": \"title12\",\r\n\t\t\t\t\"author_id\": \"12\",\r\n                \"content\": \"content12\",\r\n                \"create_time\": \"2013-08-08 12:11:10\"\r\n\t\t\t},\r\n\t\t\t. . .,\r\n\t\t]\r\n\t}\r\n}\t\r\n\r\n```\r\n\r\n### GET Request: Sorting results (WorkController)\r\nYou can sort your results by any valid param or multiple params as well as provide a sort direction (ASC or DESC). sort=[{\"property\":\"title\", \"direction\":\"DESC\"}, {\"property\":\"create_time\", \"direction\":\"ASC\"}]\r\n\r\n\r\nJavaScript:\r\n```javascript\r\n $.ajax({\r\n    url:'/api/work?sort=[{\"property\":\"title\", \"direction\":\"DESC\"}, {\"property\":\"create_time\", \"direction\":\"ASC\"}]',\r\n    type:\"GET\",\r\n    success:function(data) {\r\n      console.log(data);\r\n    },\r\n    error:function (xhr, ajaxOptions, thrownError){\r\n      console.log(xhr.responseText);\r\n    } \r\n  }); \r\n```\r\n\r\nCURL:\r\n```shell\r\ncurl -i -H \"Accept: application/json\" -H \"X_REST_USERNAME: admin@restuser\" -H \"X_REST_PASSWORD: admin@Access\"\\\r\nhttp://my-site.com/api/work?sort=%5B%7B%22property%22%3A%22title%22%2C+%22direction%22%3A%22DESC%22%7D%2C+%7B%22property%22%3A%22create_time%22%2C+%22direction%22%3A%22ASC%22%7D%5D\r\n```\r\n\r\nResponse:\r\n```json\r\n{\r\n\t\"success\":true,\r\n\t\"message\":\"Record(s) Found\",\r\n\t\"data\":{\r\n\t\t\"totalCount\":\"30\",\r\n\t\t\"work\":[\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"29\",\r\n                \"title\": \"title30b\",\r\n\t\t\t\t\"author_id\": \"29\",\r\n                \"content\": \"content30b\",\r\n                \"create_time\": \"2013-08-07 14:05:01\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"30\",\r\n                \"title\": \"title30\",\r\n\t\t\t\t\"author_id\": \"30\",\r\n                \"content\": \"content30\",\r\n                \"create_time\": \"2013-08-08 09:10:09\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"28\",\r\n                \"title\": \"title28\",\r\n\t\t\t\t\"author_id\": \"28\",\r\n                \"content\": \"content28\",\r\n                \"create_time\": \"2013-08-09 14:05:01\"\r\n\t\t\t},\r\n\t\t\t. . .,\r\n\t\t]\r\n\t}\r\n}\t\r\n\r\n```\r\n\r\n### GET Request: Filtering results (WorkController)\r\nYou can filter your results by any valid param or multiple params as well as an operator.\r\n\r\nAvailable filter operators:\r\n* in\r\n* not in\r\n* =\r\n* !=\r\n* >\r\n* >=\r\n* <\r\n* <=\r\n* No operator is \"LIKE\"\r\n\r\n```\r\n/api/post/?filter = [\r\n  {\"property\": \"id\", \"value\" : 50, \"operator\": \">=\"}\r\n, {\"property\": \"user_id\", \"value\" : [1, 5, 10, 14], \"operator\": \"in\"}\r\n, {\"property\": \"state\", \"value\" : [\"save\", \"deleted\"], \"operator\": \"not in\"}\r\n, {\"property\": \"date\", \"value\" : \"2013-01-01\", \"operator\": \">=\"}\r\n, {\"property\": \"date\", \"value\" : \"2013-01-31\", \"operator\": \"<=\"}\r\n, {\"property\": \"type\", \"value\" : 2, \"operator\": \"!=\"}\r\n]\r\n```\r\n\r\n###POST Requests (Creating new resources)\r\nWith POST requests we must include the resource data as a JSON object in the request body.\r\n\r\n\r\nJavaScript:\r\n```javascript\r\nvar postData = {\r\n\t\"title\": \"title31\",\r\n\t\"author_id\": \"31\",\r\n\t\"content\": \"content31\",\r\n\t\"create_time\": \"2013-08-20 09:23:14\"\r\n};\r\n\r\n $.ajax({\r\n\turl:'/api/work',\r\n\tdata:JSON.stringify(postData)\r\n\ttype:\"POST\",\r\n\tsuccess:function(data) {\r\n\t\tconsole.log(data);\r\n\t},\r\n\terror:function (xhr, ajaxOptions, thrownError){\r\n\t\tconsole.log(xhr.responseText);\r\n\t} \r\n}); \r\n```\r\n\r\nCURL:\r\n```shell\r\ncurl -l -H \"Accept: application/json\" -H \"X_REST_USERNAME: admin@restuser\" -H \"X_REST_PASSWORD: admin@Access\"\\\r\n-X POST -d '{\"title\": \"title31\", \"author_id\": \"31\", \"content\": \"content31\", \"create_time\": \"2013-08-20 09:23:14\"}' http://my-site.com/api/work\r\n```\r\n\r\nResponse:\r\n```json\r\n{\r\n\t\"success\":true,\r\n\t\"message\":\"Record Created\",\r\n\t\"data\":{\r\n\t\t\"totalCount\":\"1\",\r\n\t\t\"work\":[\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"31\",\r\n                \"title\": \"title31\",\r\n\t\t\t\t\"author_id\": \"31\",\r\n                \"content\": \"content31\",\r\n                \"create_time\": \"2013-08-20 09:23:14\"\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n}\t\r\n```\r\n\r\n###PUT Requests (Updating existing resources)\r\nWith PUT requests like POST requests we must include the resource data as a JSON object in the request body.\r\n\r\nJavaScript:\r\n```javascript\r\nvar postData = {\r\n\t\"id\": \"31\",\r\n\t\"title\": \"title31\",\r\n\t\"author_id\": \"31\",\r\n\t\"content\": \"content31\",\r\n\t\"create_time\": \"2013-08-20 09:23:14\"\r\n};\r\n\r\n $.ajax({\r\n\turl:'/api/work/31',\r\n\tdata:JSON.stringify(postData)\r\n\ttype:\"PUT\",\r\n\tsuccess:function(data) {\r\n\t\tconsole.log(data);\r\n\t},\r\n\terror:function (xhr, ajaxOptions, thrownError){\r\n\t\tconsole.log(xhr.responseText);\r\n\t} \r\n}); \r\n```\r\n\r\nCURL:\r\n```shell\r\ncurl -l -H \"Accept: application/json\" -H \"X_REST_USERNAME: admin@restuser\" -H \"X_REST_PASSWORD: admin@Access\"\\\r\n-X PUT -d '{\"id\": \"31\", \"title\": \"title31\", \"author_id\": \"31\", \"content\": \"content31\", \"create_time\": \"2013-08-20 09:23:14\"}' http://my-site.com/api/work/31\r\n```\r\n\r\nResponse:\r\n```json\r\n{\r\n\t\"success\":true,\r\n\t\"message\":\"Record Updated\",\r\n\t\"data\":{\r\n\t\t\"totalCount\":\"1\",\r\n\t\t\"work\":[\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"31\",\r\n                \"title\": \"title31\",\r\n\t\t\t\t\"author_id\": \"31\",\r\n                \"content\": \"content31\",\r\n                \"create_time\": \"2013-08-20 09:23:14\"\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n}\t\r\n```\r\n\r\n### DELETE Requests (Delete a resource)\r\n\r\nJavaScript:\r\n```javascript\r\n $.ajax({\r\n    url:'/api/work/1',\r\n    type:\"DELETE\",\r\n    success:function(data) {\r\n      console.log(data);\r\n    },\r\n    error:function (xhr, ajaxOptions, thrownError){\r\n      console.log(xhr.responseText);\r\n    } \r\n  }); \r\n```\r\n\r\n\r\nCURL:\r\n```shell\r\ncurl -l -H \"Accept: application/json\" -H \"X_REST_USERNAME: admin@restuser\" -H \"X_REST_PASSWORD: admin@Access\"\\\r\n\"X-HTTP-Method-Override: DELETE\" -X DELETE http://my-site.com/api/work/1\r\n\r\n```\r\n\r\nResponse:\r\n```json\r\n{\r\n\t\"success\":true,\r\n\t\"message\":\"Record Deleted\",\r\n\t\"data\":{\r\n\t\t\"totalCount\":\"1\",\r\n\t\t\"work\":[\r\n\t\t\t{\r\n\t\t\t\t\"id\": \"1\",\r\n                \"title\": \"title1\",\r\n\t\t\t\t\"author_id\": \"1\",\r\n                \"content\": \"content1\",\r\n                \"create_time\": \"2013-08-07 10:09:41\"\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n}\t\r\n```\r\n\r\n### Sub-Resources\r\n  \r\nWhen working with 'many to many' relations you now have the ability to treat them as sub-resources.  \r\n\r\nConsider:  \r\n```\r\nURL Format: http://mysite.com/api/<controller>/<id>/<many_many_relation>/<many_many_relation_id>\r\n\r\nGetting player 3 who is on team 1  \r\nor simply checking whether player 3 is on that team (200 vs. 404)  \r\nGET /api/team/1/players/3  \r\n\r\ngetting player 3 who is also on team 3  \r\nGET /api/team/3/players/3  \r\n\r\nAdding player 3 also to team 2  \r\nPUT /api/team/2/players/3  \r\n\r\nGetting all teams of player 3  \r\nGET /api/player/3/teams  \r\n\r\nRemove player 3 from team 1 (Injury)\r\nDELETE /api/team/1/players/3  \r\n\r\nTeam 1 found a replacement, who is not registered in league yet  \r\nPOST /api/player  \r\n\r\nFrom payload you get back the id, now place it officially to team 1  \r\nPUT /api/team/1/players/44  \r\n```\r\n\r\n## Customization & Configuration\r\nRestfullYii's default behaviors can be easily customized though the built-in event system. Almost all aspects of RestFullYii's request / response handling trigger events. Changing RestfullYii's behaviors is as simple as registering the appropriate event handlers. Event handlers can be registered both globally (in the main config) and locally (at the controller level).\r\n\r\nTo understand how to do this, lets create a scenario that requires some customization and see how we might accomplish it.\r\n\r\nLets say we have two controllers in our API, WorkController and CategoryController. We would like our API to function in the following ways:\r\n\r\n1. The API should be accessible to JavaScript via AJAX.\r\n2. The API should not be accessible to any external client.\r\n3. Only registered users should be allowed to view Work and Category resources.\r\n4. Only users with the permission REST-UPDATE should be allowed to update works.\r\n5. Only users with the permission REST-CREATE should be allowed to create works.\r\n6. Only users with the permission REST-DELETE should be allowed to delete works.\r\n7. Create, update and delete on categories should be disallowed for all API users.\r\n\r\nNow that we know how we would like our API to function, lets take a look at the list above and determine which features can be implemented globally. Since 1, 2 and 3 effect both of our controllers, we can effect these globally by registering a few callbacks in our config/main.php.\r\n\r\nTo accomplish 1 & 3 we don't have to do anything as this is RestfullYii's default behavior, so that leaves 2. By default RestfullYii does allow access to external clients which is not what we want. Lets change it!\r\n\r\nIn the /protected/config/main.php params section we will add the following:\r\n```php\r\n$config = array(\r\n\t..,\r\n\t'params'=>[\r\n\t\t'RestfullYii' => [\r\n\t\t\t'req.auth.user'=>function($application_id, $username, $password) {\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t]\r\n\t]\r\n);\r\n```\r\n\r\nThis tells RestfullYii that when the event 'req.auth.user' is handled it should always return false. Returning false will deny access (true grants it). Similarly validating an AJAX user has it's own event 'req.auth.ajax.user' which (as mentioned earlier) allows access to registered users by default.\r\n\r\nThat takes care of our global config and we can now focus on features 4-7 while taking care not to break feature 3. Since features 4-6 involve the work controller and user permissions, we can accomplish all of those at the same time. Remember RestfullYii's default behavior is to allow all registered users complete API access and again this is not what we want. Lets change it!\r\n\r\nWe will now register an event handler locally in the WorkController; To do this we will need to add a special public method in the WorkController called 'restEvents'. Then once we have the 'restEvents' method we can use one other special method 'onRest' to register our event handler. We can call 'onRest' using '$this->onRest()'. 'onRest' takes two params the first is the event name and the second is a Callable that will actually handle the event. This Callable is bound to the controller so the $this context inside the Callable always refers to the current controller. This is true for event handlers registered both globally as well as locally.\r\n\r\nNow we are ready modify the output of event handler 'req.auth.ajax.user', but this time instead of overriding the default behavior, we will use the post-filter feature to add our additional user validation. The event name of a post-filter event is always the main event name prefixed with 'post.filter.', thus in our case the event name is 'post.filter.req.auth.ajax.user'. The param(s) passed into a post-filter handler are always the value(s) returned from the main event. Take a look:\r\n\r\n```php\r\nclass WorkController extends Controller\r\n{\r\n\t.. .\r\n\t\r\n\tpublic function restEvents()\r\n\t{\r\n\t\t$this->onRest('post.filter.req.auth.ajax.user', function($validation) {\r\n\t\t\tif(!$validation) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tswitch ($this->getAction()->getId()) {\r\n\t\t\t\tcase 'REST.POST':\r\n\t\t\t\t\treturn Yii::app()->user->checkAccess('REST-CREATE');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'REST.POST':\r\n\t\t\t\t\treturn Yii::app()->user->checkAccess('REST-UPDATE');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'REST.DELETE':\r\n\t\t\t\t\treturn Yii::app()->user->checkAccess('REST-DELETE');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t.. .\r\n}\r\n```\r\n\r\nCool! That just leaves feature 7, disallowing create, update, delete on category. Again we will add this change locally, but this time to the CategoryController. Take a look:\r\n\r\n```php\r\nclass CategoryController extends Controller\r\n{\r\n\t.. .\r\n\t\r\n\tpublic function restEvents()\r\n\t{\r\n\t\t$this->onRest('post.filter.req.auth.ajax.user', function($validation) {\r\n\t\t\tif(!$validation) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn ($this->getAction()->getId() == 'REST.GET');\r\n\t\t});\r\n\t}\r\n\t\r\n\t.. .\r\n}\r\n\r\n```\r\n\r\nWe now have all features implemented! \r\n\r\n## Defining Custom Routes\r\nCustom routes are very simple to define as all you really need to do is create an event handler for your route and http verb combination (event name = 'req.\\<verb>.\\<route_name>.render').  Lets take a look at some examples.\r\n\r\nHere is the list of routes we would like to add to our api:\r\n\r\n1. [GET] /api/category/active \r\n\r\n2. [GET] /api/work/special/\\<param1>\r\n\r\n3. [PUT] /api/work/special/\\<param1>/\\<param2>\r\n\r\n4. [POST] /api/work/special/\\<param1>\r\n\r\n5. [DELETE] /api/work/special/\\<param1>/\\<param2>\r\n\r\n\r\n### Custom Route 1\r\nAs you tell from the route the request will be handled by the Category controller. So that is where we will add our event handler.\r\n\r\n```php\r\nclass CategoryController extends Controller\r\n{\r\n\t.. .\r\n\tpublic function restEvents()\r\n    {\r\n    \t$this->onRest('req.get.active.render', function() {\r\n    \t\t//Custom logic for this route.\r\n    \t\t//Should output results.\r\n    \t\t$this->emitRest('req.render.json', [\r\n    \t\t\t[\r\n    \t\t\t\t'type'=>'raw',\r\n    \t\t\t\t'data'=>['active'=>true]\r\n    \t\t\t]\r\n    \t\t])\r\n\t\t});\r\n\t}\r\n}\r\n```\r\n\r\n### Custom Routes 2-5\r\nThese routes all involve the Work controller. So that is where we will add our event handlers.\r\n\r\n```php\r\nclass WorkController extends Controller\r\n{\r\n\t.. .\r\n\t\r\n\tpublic function restEvents()\r\n\t{\r\n\t\t$this->emitRest('req.get.special.render', function($param1) {\r\n\t\t\techo CJSON::encode(['param1'=>$param1]);\r\n\t\t});\r\n\t\t\r\n\t\t$this->emitRest('req.put.special.render', function($data, $param1, $param2) {\r\n\t\t\t//$data is the data sent in the PUT\r\n\t\t\techo CJSON::encode(['data'=>$data, $param1, $param2]);\r\n\t\t});\r\n\t\t\r\n\t\t$this->emitRest('req.post.special.render', function($data, $param1) {\r\n\t\t\t//$data is the data sent in the POST\r\n\t\t\techo CJSON::encode(['data'=>$data, 'param1'=>$param1, 'param2'=>$param2]);\r\n\t\t});\r\n\t\t\r\n\t\t$this->emitRest('req.delete.special.render', function($param1, $param2) {\r\n\t\t\techo CJSON::encode(['param1'=>$param1, 'param2'=>$param2]);\r\n\t\t});\r\n\t}\r\n\r\n```\r\n\r\n## Events\r\nList of all events and their default event handlers.\r\n\r\n| Event  | Pre-Filter  | Post-Filter | Description|\r\n|---------------|----------------|----------------|----------------|\r\n| Configuration Events |\r\n| [config.application.id](#config.application.id)  |   [Yes](#pre.filter.config.application.id)   | [Yes](#post.filter.config.application.id) | Returns the app id that is applied to header vars (username, password) |\r\n| [config.dev.flag](#config.dev.flag)    |   [Yes](#pre.filter.config.dev.flag)  | [Yes](#post.filter.config.dev.flag) | Return true to set develop mode; False to turn of develop mode |\r\n| Request Events |\r\n| [req.event.logger](#req.event.logger)   |   No  | No | Logs events |\r\n| [req.auth.https.only](#req.auth.https.only)   |   [Yes](#pre.filter.req.auth.https.only)  | [Yes](#post.filter.req.auth.https.only) | Return true to restrict to https; false to allow http or https |\r\n| [req.auth.username](#req.auth.username)   |   [Yes](#pre.filter.req.auth.username)   | [Yes](#post.filter.req.auth.username)  | This is the username used to grant access to non-ajax users. At a minimum you should change this value |\r\n| [req.auth.password](#req.auth.password)   |   [Yes](#pre.filter.req.auth.password)  | [Yes](#post.filter.req.auth.password) |  This is the password use to grant access to non-ajax users. At a minimum you should change this value |\r\n| [req.auth.user](#req.auth.user)   |   [Yes](#pre.filter.req.auth.user)  | [Yes](#post.filter.req.auth.user) |  Used to validate a non-ajax user; return true to allow; false to deny |\r\n| [req.auth.ajax.user](#req.auth.ajax.user)   |   [Yes](#pre.filter.req.auth.ajax.user)  | [Yes](#post.filter.req.auth.ajax.user) |  Used to validate a an ajax user; return true to allow; false to deny |\r\n| [req.after.action](#req.after.action)   |   [Yes](#pre.filter.req.after.action)  | [Yes](#post.filter.req.after.action) |  Called after the request has been fulfilled. By default it has no behavior |\r\n| [req.param.is.pk](#req.param.is.pk)   |   [Yes](#pre.filter.req.param.is.pk)  | [Yes](#post.filter.req.param.is.pk) |  Called when attempting to validate a resources primary key. The default is an integer. Return true to confirm Primary Key; False to deny primary key. |\r\n| [req.data.read](#req.data.read)   |   [Yes](#pre.filter.req.data.read)  | [Yes](#post.filter.req.data.read) |  Called when reading data on POST & PUT requests |\r\n| [req.get.resource.render](#req.get.resource.render)   |   [Yes](#pre.filter.req.get.resource.render)  | No |  Called when a GET request for a single resource is to be rendered |\r\n| [req.get.resources.render](#req.get.resources.render)   |   [Yes](#pre.filter.req.get.resources.render)  | No |  Called when a GET request for when a list resources is to be rendered |\r\n| [req.put.resource.render](#req.put.resource.render)   |   [Yes](#pre.filter.req.put.resource.render)  | No |  Called when a PUT request for a single resource is to be rendered |\r\n| [req.post.resource.render](#req.post.resource.render)   |   [Yes](#pre.filter.req.post.resource.render)  | No |  Called when a POST request is to be rendered |\r\n| [req.delete.resource.render](#req.delete.resource.render)   |   [Yes](#pre.filter.req.delete.resource.render)  | No |  Called when a DELETE request is to be rendered |\r\n| [req.get.subresource.render](#req.get.subresource.render)   |   [Yes](#pre.filter.req.get.subresource.render)  | No |  Called when a GET request for a single sub-resource is to be rendered |\r\n| [req.get.subresources.render](#req.get.subresources.render)   |   [Yes](#pre.filter.req.get.subresources.render)  | No |  Called when a GET request for a list of sub-resources is to be rendered |\r\n| [req.put.subresource.render](#req.put.subresource.render)   |   [Yes](#pre.filter.req.put.subresource.render)  | No |  Called when a PUT request for a single sub-resource is to be rendered |\r\n| [req.delete.subresource.render](#req.delete.subresource.render)   |   [Yes](#pre.filter.req.delete.subresource.render)  | No |  Called when a DELETE request on a sub-resource is to be rendered |\r\n| [req.render.json](#req.render.json)   |   [Yes](#pre.filter.req.render.json)  | No |   NOT CALLED INTERNALLY. The event exists to allow users the ability to easily render arbitrary JSON.|\r\n| [req.exception](#req.exception)   |   [Yes](#pre.filter.req.exception)  | No |  Error handler called when an Exception is thrown |\r\n| Model Events |\r\n| [model.instance](#model.instance)   |   [Yes](#pre.filter.model.instance)  | [Yes](#post.filter.model.instance) |   Called when an instance of the model representing the resource(s) is requested. By default this is your controller class name minus the 'Controller' |\r\n| [model.attach.behaviors](#model.attach.behaviors)   |   [Yes](#pre.filter.model.attach.behaviors)  | [Yes](#post.filter.model.attach.behaviors) |   Attaches helper behaviors to model. Called on all requests (Other then custom) to add some magic to your models. |\r\n| [model.with.relations](#model.with.relations)   |   [Yes](#pre.filter.model.with.relations)  | [Yes](#post.filter.model.with.relations) |    Called when trying to determine which relations to include in a requests render. The default is all relations not starting with an underscore. You should most likely customize this per resource controller as some resources may have relations that return large number of records |\r\n| [model.lazy.load.relations](#model.lazy.load.relations)   |   [Yes](#pre.filter.model.lazy.load.relations)  | [Yes](#post.filter.model.lazy.load.relations) |    Called when determining if relations should be lazy or eager loaded. The default is to lazy load. In most cases this is sufficient. Under certain conditions eager loading my be more appropriate |\r\n| [model.limit](#model.limit)   |   [Yes](#pre.filter.model.limit)  | [Yes](#post.filter.model.limit) |     Called when applying a limit to the resources returned in a GET request. The default is 100 or the value of the _GET param 'limit' |\r\n| [model.offset](#model.offset)   |   [Yes](#pre.filter.model.offset)  | [Yes](#post.filter.model.offset) |     Called when applying an offset to the records returned in a GET request. The default is 0 or the value of the _GET param 'offset'|\r\n| [model.scenario](#model.scenario)   |   [Yes](#pre.filter.model.scenario)  | [Yes](#post.filter.model.scenario) |     Called before a resource(s) is found. This is the scenario to apply to a resource pre-find. The default is 'search' or the value of the _GET param 'scenario'. At this point setting the scenario does very little, but is included here so that you may create custom functionality with little modification.|\r\n| [model.filter](#model.filter)   |   [Yes](#pre.filter.model.filter)  | [Yes](#post.filter.model.filter) |     Called when attempting to apply a filter to apply to the records in a GET request. The default is 'NULL' or the value of the _GET param 'filter'. The format is JSON: '[{\"property\":\"SOME_PROPERTY\", \"value\":\"SOME_VALUE\", \"operator\": =\"\"}]'\r\n| [model.sort](#model.sort)   |   [Yes](#pre.filter.model.sort)  | [Yes](#post.filter.model.sort) |     Called when attempting to sort records returned in a GET request. The default is 'NULL' or the value of the _GET param 'sort'. Rhe format is JSON:[{\"property\":\"SOME_PROPERTY\", \"direction\":\"DESC\"}]\r\n| [model.find](#model.find)   |   [Yes](#pre.filter.model.find)  | [Yes](#post.filter.model.find) |     Called when attempting to find a single model\r\n| [model.find.all](#model.find.all)   |   [Yes](#pre.filter.model.find.all)  | [Yes](#post.filter.model.find.all) |      Called when attempting to find a list of models\r\n| [model.count](#model.count)   |   [Yes](#pre.filter.model.count)  | [Yes](#post.filter.model.count) |      Called when the count of model(s) is needed\r\n| [model.subresource.find](#model.subresource.find)   |   [Yes](#pre.filter.model.subresource.find)  | [Yes](#post.filter.model.subresource.find) |      Called when attempting to find a subresource\r\n| [model.subresource.find.all](#model.subresource.find.all)   |   [Yes](#pre.filter.model.subresource.find.all)  | [Yes](#post.filter.model.subresource.find.all) |      Called when attempting to find all subresources of a resource\r\n| [model.subresource.count](#model.subresource.count)   |   [Yes](#pre.filter.model.subresource.count)  | [Yes](#post.filter.model.subresource.count) |       Called when the count of sub-resources is needed\r\n| [model.apply.post.data](#model.apply.post.data)   |   [Yes](#pre.filter.model.apply.post.data)  | [Yes](#post.filter.model.apply.post.data) |       Called on POST requests when attempting to apply posted data\r\n| [model.apply.put.data](#model.apply.put.data)   |   [Yes](#pre.filter.model.apply.put.data)  | [Yes](#post.filter.model.apply.put.data) |       Called on PUT requests when attempting to apply PUT data\r\n| [model.save](#model.save)   |   [Yes](#pre.filter.model.save)  | [Yes](#post.filter.model.save) |       Called whenever a model resource is saved\r\n| [model.subresources.save](#model.subresources.save)   |   [Yes](#pre.filter.model.subresources.save)  | [Yes](#post.filter.model.subresources.save) |       Called whenever a sub-resource is saved\r\n| [model.delete](#model.delete)   |   [Yes](#pre.filter.model.delete)  | [Yes](#post.filter.model.delete) |       Called whenever a model resource needs deleting\r\n| [model.subresource.delete](#model.subresource.delete)   |   [Yes](#pre.filter.model.subresource.delete)  | [Yes](#post.filter.model.subresource.delete) |       Called whenever a subresource needs deleting\r\n| [model.restricted.properties](#model.restricted.properties)   |   [Yes](#pre.filter.model.restricted.properties)  |  [Yes](#post.filter.model.restricted.properties) |       Called when determining which properties if any should be considered restricted. The default is \\[] (no restricted properties)\r\n| [model.visible.properties](#model.visible.properties)   |   [Yes](#pre.filter.model.visible.properties)  |  [Yes](#post.filter.model.visible.properties) |       Called when determining which properties if any should be visible. The default is \\[] (no hidden properties)\r\n[model.hidden.properties](#model.hidden.properties)   |   [Yes](#pre.filter.model.hidden.properties)  |  [Yes](#post.filter.model.hidden.properties) |       Called when determining which properties if any should be hidden. The default is \\[] (no hidden properties)\r\n\r\n###<a name=\"config.application.id\"/>config.application.id</a>\r\n```php\r\n/**\r\n * config.application.id\r\n *\r\n * returns the app id that is applied to header vars (username, password)\r\n *\r\n * @return (String) default is 'REST'\r\n */\r\n$this->onRest('config.application.id', function() {\r\n\treturn 'REST';\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.config.application.id\"/>pre.filter.config.application.id</a>\r\n```php\r\n$this->onRest('pre.filter.config.application.id', function() {\r\n\t//no return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.config.application.id\"/>post.filter.config.application.id</a>\r\n```php\r\n$this->onRest('post.filter.config.application.id', function($app_id) {\r\n\treturn $app_id; //String\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"config.dev.flag\"/>config.dev.flag</a>\r\n```php\r\n/**\r\n * config.dev.flag\r\n *\r\n * return true to set develop mode; false to turn of develop mode\r\n *\r\n * @return (bool) true by default\r\n */\r\n$this->onRest('config.dev.flag', function() {\r\n\treturn true;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.config.dev.flag\"/>pre.filter.config.dev.flag</a>\r\n```php\r\n$this->onRest('pre.filter.config.dev.flag', function() {\r\n\t//no return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.config.dev.flag\"/>post.filter.config.dev.flag</a>\r\n```php\r\n$this->onRest('post.filter.config.dev.flag', function($flag) {\r\n\treturn $flag; //Bool\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.event.logger\"/>req.event.logger</a>\r\n```php\r\n/**\r\n* req.event.logger\r\n*\r\n* @param (String) (event) the event to log\r\n* @param (String) (category) the log category\r\n* @param (Array) (ignore) Events to ignore logging\r\n*\r\n* @return (Array) the params sent into the event\r\n*/\r\n$this->onRest('req.event.logger', function($event, $category='application',$ignore=[]) {\r\n\tif(!isset($ignore[$event])) {\r\n\t\tYii::trace($event, $category);\r\n\t}\r\n\treturn [$event, $category, $ignore];\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.auth.https.only\"/>req.auth.https.only</a>\r\n```php\r\n/**\r\n * req.auth.https.only\r\n *\r\n * return true to restrict to https;\r\n * false to allow http or https\r\n *\r\n * @return (bool) default is false\r\n */ \r\n$this->onRest('req.auth.https.only', function() {\r\n\treturn false;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.auth.https.only\"/>pre.filter.req.auth.https.only</a>\r\n```php\r\n$this->onRest('pre.filter.req.auth.https.only', function() {\r\n\t//no return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.auth.https.only\"/>post.filter.req.auth.https.only</a>\r\n```php\r\n$this->onRest('post.filter.req.auth.https.only', function($https_only) {\r\n\treturn $https_only; //Bool\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"req.auth.username\"/>req.auth.username</a>\r\n```php\r\n/**\r\n * req.auth.username\r\n *\r\n * This is the username used to grant access to non-ajax users\r\n * At a minimum you should change this value\r\n *\r\n * @return (String) the username\r\n */ \r\n$this->onRest('req.auth.username', function(){\r\n\treturn 'admin@restuser';\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.auth.username\"/>pre.filter.req.auth.username</a>\r\n```php\r\n$this->onRest('pre.filter.req.auth.username', function() {\r\n\t//no return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.auth.username\"/>post.filter.req.auth.username</a>\r\n```php\r\n$this->onRest('post.filter.req.auth.username', function($username) {\r\n\treturn $username; //String\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"req.auth.password\"/>req.auth.password</a>\r\n```php\r\n/**\r\n * req.auth.password\r\n *\r\n * This is the password use to grant access to non-ajax users\r\n * At a minimum you should change this value\r\n *\r\n * @return (String) the password\r\n */ \r\n$this->onRest('req.auth.password', function(){\r\n\treturn 'admin@Access';\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.auth.password\"/>pre.filter.req.auth.password</a>\r\n```php\r\n$this->onRest('pre.filter.req.auth.password', function() {\r\n\t//no return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.auth.password\"/>post.filter.req.auth.password</a>\r\n```php\r\n$this->onRest('post.filter.req.auth.password', function($password) {\r\n\treturn $password; //String\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"req.auth.user\"/>req.auth.user</a>\r\n```php\r\n/**\r\n * req.auth.user\r\n *\r\n * Used to validate a non-ajax user\r\n *\r\n * @param (String) (application_id) the application_id defined in config.application.id\r\n * @param (String) (username) the username defined in req.auth.username\r\n * @param (String) (password) the password defined in req.auth.password\r\n *\r\n * @return (Bool) true to grant access; false to deny access\r\n */ \r\n$this->onRest('req.auth.user', function($application_id, $username, $password) {\r\n\tif(!isset($_SERVER['HTTP_X_'.$application_id.'_USERNAME']) || !isset($_SERVER['HTTP_X_'.$application_id.'_PASSWORD'])) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\tif( $username != $_SERVER['HTTP_X_'.$application_id.'_USERNAME'] ) {\r\n\t\treturn false;\r\n\t}\r\n\tif( $password != $_SERVER['HTTP_X_'.$application_id.'_PASSWORD'] ) {\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.auth.user\"/>pre.filter.req.auth.user</a>\r\n```php\r\n$this->onRest('pre.filter.req.auth.user', function($application_id, $username, $password) {\r\n\treturn [$application_id, $username, $password]; //Array [String, String, String]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.auth.user\"/>post.filter.req.auth.user</a>\r\n```php\r\n$this->onRest('post.filter.req.auth.user', function($validation) {\r\n\treturn $validation; //Bool\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"req.auth.ajax.user\"/>req.auth.ajax.user</a>\r\n```php\r\n/**\r\n * req.auth.ajax.user\r\n *\r\n * Used to validate an ajax user\r\n * That is requests originating from JavaScript\r\n * By default all logged-in users will be granted access\r\n * everyone else will be denied\r\n * You should most likely over ride this\r\n *\r\n * @return (Bool) return true to grant access; false to deny access\r\n */ \r\n$this->onRest('req.auth.ajax.user', function() {\r\n\tif(Yii::app()->user->isGuest) {\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.auth.ajax.user\"/>pre.filter.req.auth.ajax.user</a>\r\n```php\r\n$this->onRest('pre.filter.req.auth.ajax.user', function() {\r\n\t//no return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.auth.ajax.user\"/>post.filter.req.auth.ajax.user</a>\r\n```php\r\n$this->onRest('post.filter.req.auth.ajax.user', function($validation) {\r\n\treturn $validation; //String\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n####<a name=\"req.after.action\"/>req.after.action</a>\r\n```php\r\n/**\r\n * req.after.action\r\n *\r\n * Called after the request has been fulfilled\r\n * By default it has no behavior\r\n */ \r\n$this->onRest('req.after.action', function($filterChain) {\r\n\t//Logic being applied after the action is executed\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.after.action\"/>pre.filter.req.after.action</a>\r\n```php\r\n$this->onRest('pre.filter.req.after.action', function($filterChain) {\r\n\treturn $filterChain; //Object\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.after.action\"/>post.filter.req.after.action</a>\r\n```php\r\n$this->onRest('post.filter.after.action', function($result=null) {\r\n\treturn $result; //Mixed\r\n});\r\n```\r\n\r\n\r\n###<a name=\"req.param.is.pk\"/>req.param.is.pk</a>\r\n```php\r\n/**\r\n * req.param.is.pk\r\n *\r\n * Called when attempting to validate a resources primary key\r\n * The default is an integer\r\n *\r\n * @return (bool) true to confirm primary key; false to deny\r\n */\r\n$this->onRest('req.param.is.pk', function($pk) {\r\n\treturn $pk === '0' || preg_match('/^-?[1-9][0-9]*$/', $pk) === 1;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.param.is.pk\"/>pre.filter.req.param.is.pk</a>\r\n```php\r\n$this->onRest('pre.filter.req.param.is.pk, function($pk) {\r\n\treturn $pk; //Mixed\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.param.is.pk\"/>post.filter.req.param.is.pk</a>\r\n```php\r\n$this->onRest('post.filter.req.param.is.pk', function($isPk) {\r\n\treturn $isPk; //Bool\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"req.data.read\"/>req.data.read</a>\r\n```php\r\n/**\r\n * req.data.read\r\n *\r\n * Called when reading data on POST & PUT requests\r\n *\r\n * @param (String) this can be either a stream wrapper of a file path\r\n *\r\n * @return (Array) the JSON decoded array of data\r\n */ \r\n$this->onRest('req.data.read', function($stream='php://input') {\r\n\t$reader = new ERestRequestReader($stream);\r\n\treturn CJSON::decode($reader->getContents());\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.data.read\"/>pre.filter.req.data.read</a>\r\n```php\r\n$this->onRest('pre.filter.req.data.read, function($stream='php://input') {\r\n\treturn $stream; //Mixed\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.req.data.read\"/>post.filter.req.data.read</a>\r\n```php\r\n$this->onRest('post.filter.req.data.read', function($data) {\r\n\treturn [$data]; //Array [Array]\r\n});\r\n```\r\n\r\n\r\n\r\n###<a name=\"req.get.resource.render\"/>req.get.resource.render</a>\r\n```php\r\n/**\r\n * req.get.resource.render\r\n *\r\n * Called when a GET request for a single resource is to be rendered\r\n * @param (Object) (data) this is the resources model\r\n * @param (String) (model_name) the name of the resources model\r\n * @param (Array) (relations) the list of relations to include with the data\r\n * @param (Int) (count) the count of records to return (will be either 1 or 0)\r\n */\r\n$this->onRest('req.get.resource.render', function($data, $model_name, $relations, $count) {\r\n\t//Handler for GET (single resource) request\r\n\t$this->setHttpStatus((($count > 0)? 200: 204));\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> (($count > 0)? true: false),\r\n\t\t'message'\t\t\t=> (($count > 0)? \"Record Found\": \"No Record Found\"),\r\n\t\t'totalCount'\t\t=> $count,\r\n\t\t'modelName'\t\t\t=> $model_name,\r\n\t\t'relations'\t\t\t=> $relations,\r\n\t\t'data'\t\t\t\t=> $data,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.get.resource.render\"/>pre.filter.req.get.resource.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.get.resource.render, function($data, $model_name, $relations, $count) {\r\n\treturn [$data, $model_name, $relations, $count]; //Array [Object, String, Array, Int]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n####<a name=\"req.get.resources.render\"/>req.get.resources.render</a>\r\n```php\r\n/**\r\n * req.get.resources.render\r\n *\r\n * Called when a GET request for when a list resources is to be rendered\r\n *\r\n * @param (Array) (data) this is an array of models representing the resources\r\n * @param (String) (model_name) the name of the resources model\r\n * @param (Array) (relations) the list of relations to include with the data\r\n * @param (Int) (count) the count of records to return\r\n */\r\n$this->onRest('req.get.resources.render', function($data, $model_name, $relations, $count) {\r\n\t//Handler for GET (list resources) request\r\n\t$this->setHttpStatus((($count > 0)? 200: 204));\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> (($count > 0)? true: false),\r\n\t\t'message'\t\t\t=> (($count > 0)? \"Record(s) Found\": \"No Record(s) Found\"),\r\n\t\t'totalCount'\t\t=> $count,\r\n\t\t'modelName'\t\t\t=> $model_name,\r\n\t\t'relations'\t\t\t=> $relations,\r\n\t\t'data'\t\t\t\t=> $data,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.get.resources.render\"/>pre.filter.req.get.resources.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.get.resources.render, function($data, $model_name, $relations, $count) {\r\n\treturn [$data, $model_name, $relations, $count]; //Array [Array [Object], String, Array, Int]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.put.resource.render\"/>req.put.resource.render</a>\r\n```php\r\n/**\r\n * req.put.resource.render\r\n * \r\n * Called when a PUT request (update) is to be rendered\r\n *\r\n * @param (Object) (model) the updated model\r\n * @param (Array) (relations) list of relations to render with model\r\n */\r\n$this->onRest('req.put.resource.render' function($model, $relations) {\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> 'true',\r\n\t\t'message'\t\t\t=> \"Record Updated\",\r\n\t\t'totalCount'\t=> \"1\",\r\n\t\t'modelName'\t\t=> get_class($model),\r\n\t\t'relations'\t\t=> $relations,\r\n\t\t'data'\t\t\t\t=> $model,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.put.resource.render\"/>pre.filter.req.put.resource.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.req.put.resource.render, function($model, $relations) {\r\n\treturn [$model, relations]; //Array [Object, Array]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"req.post.resource.render\"/>req.post.resource.render</a>\r\n```php\r\n/**\r\n * req.post.resource.render\r\n * \r\n * Called when a POST request (create) is to be rendered\r\n *\r\n * @param (Object) (model) the newly created model\r\n * @param (Array) (relations) list of relations to render with model\r\n */\r\n$this->onRest('req.post.resource.render', function($model, $relations=[]) {\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> 'true',\r\n\t\t'message'\t\t\t=> \"Record Created\",\r\n\t\t'totalCount'\t=> \"1\",\r\n\t\t'modelName'\t\t=> get_class($model),\r\n\t\t'relations'\t\t=> $relations,\r\n\t\t'data'\t\t\t\t=> $model,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.post.resource.render\"/>pre.filter.req.post.resource.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.post.resource.render', function($model, $relations) {\r\n\treturn [$model, relations]; //Array [Object, Array]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.delete.resource.render\"/>req.delete.resource.render</a>\r\n```php\r\n/**\r\n * req.delete.resource.render\r\n *\r\n * Called when DELETE request is to be rendered\r\n *\r\n * @param (Object) (model) this is the deleted model object for the resource\r\n */\r\n$this->onRest('req.delete.resource.render', function($model) {\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> 'true',\r\n\t\t'message'\t\t\t=> \"Record Deleted\",\r\n\t\t'totalCount'\t\t=> \"1\",\r\n\t\t'modelName'\t\t\t=> get_class($model),\r\n\t\t'relations'\t\t\t=> [],\r\n\t\t'data'\t\t\t\t=> $model,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.delete.resource.render\"/>req.delete.resource.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.delete.resource.render', function($model) {\r\n\treturn $model; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.get.subresource.render\">req.get.subresource.render</a>\r\n```php\r\n/**\r\n * req.get.subresource.render\r\n *\r\n * Called when a GET request for a sub-resource is to be rendered\r\n *\r\n * @param (Object) (model) the model representing the sub-resource\r\n * @param (String) (subresource_name) the name of the sub-resource to render\r\n * @param (Int) (count) the count of sub-resources to render (will be either 1 or 0)\r\n */\r\n$this->onRest('req.get.subresource.render', function($model, $subresource_name, $count) {\r\n\t$this->setHttpStatus((($count > 0)? 200: 204));\r\n\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> true,\r\n\t\t'message'\t\t\t=> (($count > 0)? \"Record(s) Found\": \"No Record(s) Found\"),\r\n\t\t'totalCount'\t\t=> $count,\r\n\t\t'modelName'\t\t\t=> $subresource_name,\r\n\t\t'data'\t\t\t\t=> $model,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.get.subresource.render\">pre.filter.req.get.subresource.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.get.subresource.render', function($model, $subresource_name, $count) {\r\n\treturn [$model, $subresource_name, $count]; //Array [Object, String, Int]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.get.subresources.render\">req.get.subresources.render</a>\r\n```php\r\n/**\r\n * req.get.subresources.render\r\n *\r\n * Called when a GET request for a list of sub-resources is to be rendered\r\n *\r\n * @param (Array) (models) list of sub-resource models\r\n * @param (String) (subresource_name) the name of the sub-resources to render\r\n * @param (Int) (count) the count of sub-resources to render\r\n */\r\n$this->onRest('req.get.subresources.render', function($models, $subresource_name, $count) {\r\n\t$this->setHttpStatus((($count > 0)? 200: 204));\r\n\t\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> (($count > 0)? true: false),\r\n\t\t'message'\t\t\t=> (($count > 0)? \"Record(s) Found\": \"No Record(s) Found\"),\r\n\t\t'totalCount'\t\t=> $count,\r\n\t\t'modelName'\t\t\t=> $subresource_name,\r\n\t\t'data'\t\t\t\t=> $models,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.get.subresources.render\">pre.filter.req.get.subresources.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.get.subresources.render', function($models, $subresource_name, $count) {\r\n\treturn [$models, $subresource_name, $count]; //Array [Array[Object], String, Int]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.put.subresource.render\">req.put.subresource.render</a>\r\n```php\r\n/**\r\n * req.put.subresource.render\r\n *\r\n * Called when a PUT request to a sub-resource (add a sub-resource) is rendered\r\n *\r\n * @param (Object) (model) the model of the resource that owns the subresource\r\n * @param (String) (subresource_name) the name of the sub-resource\r\n * @param (Mixed/Int) (subresource_id) the primary key of the sub-resource\r\n */\r\n$this->onRest('req.put.subresource.render', function($model, $subresource_name, $subresource_id) {\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> 'true',\r\n\t\t'message'\t\t\t=> \"Subresource Added\",\r\n\t\t'totalCount'\t\t=> \"1\",\r\n\t\t'modelName'\t\t\t=> get_class($model),\r\n\t\t'relations'\t\t\t=> [$subresource_name],\r\n\t\t'data'\t\t\t\t=> $model,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.put.subresource.render\">pre.filter.req.put.subresource.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.put.subresource.render', function($model, $subresource_name, $subresource_id) {\r\n\treturn [$model, $subresource_name, $subresource_id]; //Array [Object, String, Int]\r\n});\r\n```\r\n\r\n\r\n\r\n###<a name=\"req.delete.subresource.render\">req.delete.subresource.render</a>\r\n```php\r\n/**\r\n * req.delete.subresource.render\r\n *\r\n * Called when DELETE request on a sub-resource is to be made\r\n *\r\n * @param (Object) (model) this is the model object that owns the deleted sub-resource\r\n * @param (String) (subresource_name) the name of the deleted sub-resource\r\n * @param (Mixed/Int) (subresource_id) the primary key of the deleted sub-resource\r\n */\r\n$this->onRest('req.delete.subresource.render', function($model, $subresource_name, $subresource_id) {\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t\t=> 'rest',\r\n\t\t'success'\t\t\t=> 'true',\r\n\t\t'message'\t\t\t=> \"Sub-Resource Deleted\",\r\n\t\t'totalCount'\t\t=> \"1\",\r\n\t\t'modelName'\t\t\t=> get_class($model),\r\n\t\t'relations'\t\t\t=> [$subresource_name],\r\n\t\t'data'\t\t\t\t=> $model,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.delete.subresource.render\">pre.filter.req.delete.subresource.render</a>\r\n```php\r\n$this->onRest('pre.filter.req.delete.subresource.render', function($model, $subresource_name, $subresource_id) {\r\n\treturn [$model, $subresource_name, $subresource_id]; //Array [Object, String, Int]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.render.json\">req.render.json</a>\r\n```php\r\n/**\r\n * req.render.json\r\n * NOT CALLED internally\r\n * The handler exists to allow users the ability to easily render arbitrary JSON\r\n * To do so you must 'emitRest' this event\r\n *\r\n * @param (Array) (data) data to be rendered\r\n */\r\n$this->onRest('req.render.json', function($data) {\r\n\t$this->renderJSON([\r\n\t\t'type' => 'raw',\r\n\t\t'data' => $data,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.render.json\">pre.filter.req.render.json</a>\r\n```php\r\n$this->onRest('pre.filter.req.render.json', function($data) {\r\n\treturn [$data]; //Array[Array]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"req.exception\">req.exception</a>\r\n```php\r\n/**\r\n * req.exception\r\n *\r\n * Error handler called when an Exception is thrown\r\n * Used to render response to the client\r\n *\r\n * @param (Int) (errorCode) the http status code\r\n * @param (String) the error message\r\n */\r\n$this->onRest('req.exception', function($errorCode, $message=null) {\r\n\t$this->renderJSON([\r\n\t\t'type'\t\t\t=> 'error',\r\n\t\t'success'\t\t=> false,\r\n\t\t'message'\t\t=> (is_null($message)? $this->getHttpStatus()->message: $message),\r\n\t\t'errorCode' => $errorCode,\r\n\t]);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.req.exception\">pre.filter.req.exception</a>\r\n```php\r\n$this->onRest('pre.filter.req.exception', function($errorCode, $message=null) {\r\n\treturn [$errorCode, $message=null]; //Array [Int, String]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.instance\">model.instance</a>\r\n```php\r\n/**\r\n * model.instance\r\n *\r\n * Called when an instance of the model representing the resource(s) is requested\r\n * By default this is your controller class name minus the 'Controller'\r\n *\r\n * @return (Object) an empty instance of a resources Active Record model\r\n */\r\n$this->onRest('model.instance', function() {\r\n\t$modelName = str_replace('Controller', '', get_class($this));\r\n\treturn new $modelName();\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.instance\">pre.filter.model.instance</a>\r\n```php\r\n$this->onRest('pre.filter.model.instance', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.instance\">post.filter.model.instance</a>\r\n```php\r\n$this->onRest('post.filter.model.instance', function($result)) {\r\n\treturn $result; //\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.attach.behaviors\">model.attach.behaviors</a>\r\n```php\r\n/**\r\n * model.attach.behaviors\r\n *\r\n * Called on all requests (Other then custom) to add some magic to your models\r\n * Attach helper behaviors to model\r\n *\r\n * @param (Object) (model) an instance of an AR Model\r\n *\r\n * @return (Object) an instance of an Active Record model\r\n */\r\n$this->onRest('model.attach.behaviors', function($model) {\r\n\t//Attach this behavior to help saving nested models\r\n\tif(!array_key_exists('ERestActiveRecordRelationBehavior', $model->behaviors())) {\r\n\t\t$model->attachBehavior('ERestActiveRecordRelationBehavior', new ERestActiveRecordRelationBehavior());\r\n\t}\r\n\t\r\n\tif(!array_key_exists('ERestHelperScopes', $model->behaviors())) {\r\n\t\t$model->attachBehavior('ERestHelperScopes', new ERestHelperScopes());\r\n\t}\r\n\treturn $model;\r\n});\r\n```\t\r\n\r\n####<a name=\"pre.filter.model.attach.behaviors\">pre.filter.model.attach.behaviors</a>\r\n```php\r\n$this->onRest('pre.filter.model.attach.behaviors', function($model) {\r\n\treturn $model //Object\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.attach.behaviors\">post.filter.model.attach.behaviors</a>\r\n```php\r\n$this->onRest('post.filter.model.attach.behaviors', function($model)) {\r\n\treturn $model; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.with.relations\">model.with.relations</a>\r\n```php\r\n/**\r\n * model.with.relations\r\n *\r\n * Called when trying to determine which relations to include in a requests render\r\n * The default is all relations not starting with an underscore\r\n * You should most likely customize this per resource\r\n * as some resources may have relations that return large number of records\r\n *\r\n * @return (Array) list of relations (Strings) to attach to resources output\r\n */\r\n$this->onRest('model.with.relations', function($model) {\r\n\t$nestedRelations = [];\r\n\tforeach($model->metadata->relations as $rel=>$val)\r\n\t{\r\n\t\t$className = $val->className;\r\n\t\t$rel_model = call_user_func([$className, 'model']);\r\n\t\tif(!is_array($rel_model->tableSchema->primaryKey) && substr($rel, 0, 1) != '_') {\r\n\t\t\t$nestedRelations[] = $rel;\r\n\t\t}\r\n\t}\r\n\treturn $nestedRelations;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.with.relations\">pre.filter.model.with.relations</a>\r\n```php\r\n$this->onRest('pre.filter.model.with.relations', function($model) {\r\n\treturn $model; //Object\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.with.relations\">post.filter.model.with.relations</a>\r\n```php\r\n$this->onRest('post.filter.model.with.relations', function($result)) {\r\n\treturn $result; //Array[String]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.lazy.load.relations\">model.lazy.load.relations</a>\r\n```php\r\n/**\r\n * model.lazy.load.relations\r\n *\r\n * Called when determining if relations should be lazy or eager loaded\r\n * The default is to lazy load. In most cases this is sufficient\r\n * Under certain conditions eager loading my be more appropriate\r\n *\r\n * @return (Bool) true to lazy load relations; false to eager load\r\n */\r\n$this->onRest('model.lazy.load.relations', function() {\r\n\treturn true;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.lazy.load.relations\">pre.filter.model.lazy.load.relations</a>\r\n```php\r\n$this->onRest('pre.filter.model.lazy.load.relations', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.lazy.load.relations\">post.filter.model.lazy.load.relations</a>\r\n```php\r\n$this->onRest('post.filter.model.lazy.load.relations', function($result)) {\r\n\treturn $result; //Bool\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.limit\">model.limit</a>\r\n```php\r\n/**\r\n * model.limit\r\n *\r\n * Called when applying a limit to the resources returned in a GET request\r\n * The default is 100 or the value of the _GET param 'limit'\r\n *\r\n * @return (Int) the number of results to return\r\n */\r\n$this->onRest('model.limit', function() {\r\n\treturn isset($_GET['limit'])? $_GET['limit']: 100;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.limit\">pre.filter.model.limit</a>\r\n```php\r\n$this->onRest('pre.filter.model.limit', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.limit\">post.filter.model.limit</a>\r\n```php\r\n$this->onRest('post.filter.model.limit', function($result)) {\r\n\treturn $result; //Int\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.offset\">model.offset</a>\r\n```php\r\n/**\r\n * model.offset\r\n *\r\n * Called when applying an offset to the records returned in a GET request\r\n * The default is 0 or the value of the _GET param 'offset'\r\n *\r\n * @return (Int) the offset of results to return\r\n */\r\n$this->onRest('model.offset', function() {\r\n\treturn isset($_GET['offset'])? $_GET['offset']: 0;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.offset\">pre.filter.model.offset</a>\r\n```php\r\n$this->onRest('pre.filter.model.offset', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.offset\">post.filter.model.offset</a>\r\n```php\r\n$this->onRest('post.filter.model.offset', function($result)) {\r\n\treturn $result; //Int\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.scenario\">model.scenario</a>\r\n```php\r\n/**\r\n * model.scenario\r\n *\r\n * Called before a resource is found\r\n * This is the scenario to apply to a resource pre-find\r\n * The default is 'search' or the value of the _GET param 'scenario'\r\n *\r\n * @return (String) the scenario name\r\n */\r\n$this->onRest('model.scenario', function() {\r\n\treturn isset($_GET['scenario'])? $_GET['scenario']: 'search';\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.scenario\">pre.filter.model.scenario</a>\r\n```php\r\n$this->onRest('pre.filter.model.scenario', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.scenario\">post.filter.model.scenario</a>\r\n```php\r\n$this->onRest('post.filter.model.scenario', function($result)) {\r\n\treturn $result; //String\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.filter\">model.filter</a>\r\n```php\r\n/**\r\n * model.filter\r\n *\r\n * Called when attempting to apply a filter to apply to the records in a GET request\r\n * The default is 'NULL' or the value of the _GET param 'filter'\r\n * The format is JSON: \r\n * '[{\"property\":\"SOME_PROPERTY\", \"value\":\"SOME_VALUE\"}]'\r\n * See documentation for additional options\r\n *\r\n * @return (JSON) the filter to apply\r\n */\r\n$this->onRest('model.filter', function() {\r\n\treturn isset($_GET['filter'])? $_GET['filter']: null;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.filter\">pre.filter.model.filter</a>\r\n```php\r\n$this->onRest('pre.filter.model.filter', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.filter\">post.filter.model.filter</a>\r\n```php\r\n$this->onRest('post.filter.model.filter', function($result)) {\r\n\treturn $result; //Array[Object]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.sort\">model.sort</a>\r\n```php\r\n/**\r\n * model.sort\r\n *\r\n * Called when attempting to sort records returned in a GET request\r\n * The default is 'NULL' or the value of the _GET param 'sort'\r\n * The format is JSON:\r\n * [{\"property\":\"SOME_PROPERTY\", \"direction\":\"DESC\"}]\r\n *\r\n * @return (JSON) the sort to apply\r\n */ \r\n$this->onRest('model.sort', function() {\r\n\treturn isset($_GET['sort'])? $_GET['sort']: null;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.sort\">pre.filter.model.sort</a>\r\n```php\r\n$this->onRest('pre.filter.model.sort', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.sort\">post.filter.model.sort</a>\r\n```php\r\n$this->onRest('post.filter.model.sort', function($result)) {\r\n\treturn $result; //Array[Object]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.find\">model.find</a>\r\n```php\r\n/**\r\n * model.find\r\n *\r\n * Called when attempting to find a single model\r\n *\r\n * @param (Object) (model) an instance of the resources model\r\n * @param (Mixed/Int) (id) the resources primary key\r\n *\r\n * @return (Object) the found model\r\n */\r\n$this->onRest('model.find', function($model, $id) {\r\n\treturn $model->findByPk($id);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.find\">pre.filter.model.find</a>\r\n```php\r\n$this->onRest('pre.filter.model.find', function($model, $id) {\r\n\treturn [$model, $id]; //Array [Object, Int]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.find\">post.filter.model.find</a>\r\n```php\r\n$this->onRest('post.filter.model.find', function($result)) {\r\n\treturn $result; //Object\r\n});\r\n```\r\n\r\n\r\n###<a name=\"model.find.all\">model.find.all</a>\r\n```php\r\n/**\r\n * model.find.all\r\n *\r\n * Called when attempting to find a list of models\r\n *\r\n * @param (Object) (model) an instance of the resources model\r\n *\r\n * @return (Array) list of found models\r\n */\r\n$this->onRest('model.find.all', function($model) {\r\n\treturn $model->findAll();\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.find.all\">pre.filter.model.find.all</a>\r\n```php\r\n$this->onRest('pre.filter.model.find.all', function($model) {\r\n\treturn $model; //Object\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.find.all\">post.filter.model.find.all</a>\r\n```php\r\n$this->onRest('post.filter.model.find.all', function($result)) {\r\n\treturn $result; //Array[Object]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.count\">model.count</a>\r\n```php\r\n/**\r\n * model.count\r\n *\r\n * Called when the count of model(s) is needed\r\n *\r\n * @param (Object) (model) the model to apply the count to\r\n *\r\n * @return (Int) the count of models\r\n */\r\n$this->onRest('model.count', function($model) {\r\n\treturn $model->count();\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.count\">pre.filter.model.count</a>\r\n```php\r\n$this->onRest('pre.filter.model.count', function($model) {\r\n\treturn $model; //Object\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.count\">post.filter.model.count</a>\r\n```php\r\n$this->onRest('post.filter.model.count', function($result)) {\r\n\treturn $result; //Int\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.subresource.find\">model.subresource.find</a>\r\n```php\r\n/**\r\n * model.subresource.find\r\n *\r\n * Called when attempting to find a subresource\r\n *\r\n * @param (Object) (model) the model that represents the owner of the sub-resource\r\n * @param (String) (subresource_name) the name of the sub-resource\r\n * @param (Mixed/Int) (subresource_id) the primary key of the sub-resource\r\n *\r\n * @return (Object) the sub-resource model\r\n */\r\n$this->onRest('model.subresource.find', function($model, $subresource_name, $subresource_id) {\r\n\t$subresource = @$this->getSubresourceHelper()->getSubresource($model, $subresource_name, $subresource_id);\r\n\tif(count($subresource) > 0) {\r\n\t\treturn $subresource[0];\r\n\t}\r\n\treturn $subresource; //Object\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.subresource.find\">pre.filter.model.subresource.find</a>\r\n```php\r\n$this->onRest('pre.filter.model.subresource.find', function($model, $subresource_name, $subresource_id) {\r\n\treturn [$model, $subresource_name, $subresource_id]; //Array [Object, String, Int]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.subresource.find\">post.filter.model.subresource.find</a>\r\n```php\r\n$this->onRest('post.filter.model.subresource.find', function($result)) {\r\n\treturn $result; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.subresource.find.all\">model.subresource.find.all</a>\r\n```php\r\n/**\r\n * model.subresource.find.all\r\n *\r\n * Called when attempting to find all subresources of a resource\r\n *\r\n * @param (Object) (model) the model that represents the owner of the sub-resources\r\n * @param (String) (subresource_name) the name of the sub-resource\r\n *\r\n * @return (Array) list of sub-resource models\r\n */\r\n$this->onRest(ERestEvent::MODEL_SUBRESOURCES_FIND_ALL, function($model, $subresource_name) {\r\n\treturn $this->getSubresourceHelper()->getSubresource($model, $subresource_name);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.subresource.find.all\">pre.filter.model.subresource.find.all</a>\r\n```php\r\n$this->onRest('pre.filter.model.subresource.find.all', function($model, $subresource_name) {\r\n\treturn [$model, $subresource_name]; //Array [Object, String]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.subresource.find.all\">post.filter.model.subresource.find.all</a>\r\n```php\r\n$this->onRest('post.filter.model.subresource.find.all', function($result)) {\r\n\treturn $result; //Array[Object]\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.subresource.count\">model.subresource.count</a>\r\n```php\r\n/**\r\n * model.subresource.count\r\n *\r\n * Called when the count of sub-resources is needed\r\n *\r\n * @param (Object) (model) the model that represents the owner of the sub-resource\r\n * @param (String) (subresource_name) the name of the sub-resource\r\n * @param (Mixed/Int) (subresource_id) the primary key of the sub-resource\r\n *\r\n * @return (Int) count of the subresources\r\n */\r\n$this->onRest('model.subresource.count', function($model, $subresource_name, $subresource_id=null) {\r\n\treturn $this->getSubresourceHelper()->getSubresourceCount($model, $subresource_name, $subresource_id);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.subresource.count\">pre.filter.model.subresource.count</a>\r\n```php\r\n$this->onRest('pre.filter.model.subresource.count', function($model, $subresource_name, $subresource_id=null) {\r\n\treturn [$model, $subresource_name, $subresource_id=null]; //Array [Object, String, Int]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.subresource.count\">post.filter.model.subresource.count</a>\r\n```php\r\n$this->onRest('post.filter.model.subresource.count', function($result)) {\r\n\treturn $result; //Int\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.apply.post.data\">model.apply.post.data</a>\r\n```php\r\n/**\r\n * model.apply.post.data\r\n *\r\n * Called on POST requests when attempting to apply posted data\r\n *\r\n * @param (Object) (model) the resource model to save data to\r\n * @param (Array) (data) the data to save to the model\r\n * @param (Array) (restricted_properties) list of restricted properties\r\n *\r\n * @return (Object) the model with posted data applied\r\n */\r\n$this->onRest('model.apply.post.data', function($model, $data, $restricted_properties) {\r\n\treturn $this->getResourceHelper()->setModelAttributes($model, $data, $restricted_properties);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.apply.post.data\">pre.filter.model.apply.post.data</a>\r\n```php\r\n$this->onRest('pre.filter.model.apply.post.data', function($model, $data, $restricted_properties) {\r\n\treturn [$model, $data, $restricted_properties]; //Array []\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.apply.post.data\">post.filter.model.apply.post.data</a>\r\n```php\r\n$this->onRest('post.filter.model.apply.post.data', function($result)) {\r\n\treturn $result; //\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.apply.put.data\">model.apply.put.data</a>\r\n```php\r\n/**\r\n * model.apply.put.data\r\n *\r\n * Called on PUT requests when attempting to apply PUT data\r\n *\r\n * @param (Object) (model) the resource model to save data to\r\n * @param (Array) (data) the data to save to the model\r\n * @param (Array) (restricted_properties) list of restricted properties\r\n *\r\n * @return (Object) the model with PUT data applied\r\n */\r\n$this->onRest('model.apply.put.data', function($model, $data, $restricted_properties) {\r\n\treturn $this->getResourceHelper()->setModelAttributes($model, $data, $restricted_properties);\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.apply.put.data\">pre.filter.model.apply.put.data</a>\r\n```php\r\n$this->onRest('pre.filter.model.apply.put.data', function($model, $data, $restricted_properties) {\r\n\treturn [$model, $data, $restricted_properties]; //Array [Object, Array, Array]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.apply.put.data\">post.filter.model.apply.put.data</a>\r\n```php\r\n$this->onRest('post.filter.model.apply.put.data', function($result)) {\r\n\treturn $result; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n###<a name=\"model.save\">model.save</a>\r\n```php\r\n/**\r\n * model.save\r\n *\r\n * Called whenever a model resource is saved\r\n *\r\n * @param (Object) the resource model to save\r\n *\r\n * @return (Object) the saved resource\r\n */\r\n$this->onRest('model.save', function($model) {\r\n\tif(!$model->save()) {\r\n\t\tthrow new CHttpException('400', CJSON::encode($model->errors));\r\n\t}\r\n\t$model->refresh();\r\n\treturn $model;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.save\">pre.filter.model.save</a>\r\n```php\r\n$this->onRest('pre.filter.model.save', function($model) {\r\n\treturn $model; //Object\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.save\">post.filter.model.save</a>\r\n```php\r\n$this->onRest('post.filter.model.save', function($result)) {\r\n\treturn $result; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"model.subresources.save\">model.subresources.save</a>\r\n```php\r\n/**\r\n * model.subresources.save\r\n *\r\n * Called whenever a sub-resource is saved\r\n *\r\n * @param (Object) (model) the owner of the sub-resource\r\n * @param (String) (subresource_name) the name of the subresource\r\n * @param (Mixed/Int) (subresource_id) the primary key of the subresource\r\n *\r\n * @return (Object) the updated model representing the owner of the sub-resource\r\n */\r\n$this->onRest(ERestEvent::MODEL_SUBRESOURCE_SAVE, function($model, $subresource_name, $subresource_id) {\r\n\tif(!$this->getSubresourceHelper()->putSubresourceHelper($model, $subresource_name, $subresource_id)) {\r\n\t\tthrow new CHttpException('500', 'Could not save Sub-Resource');\r\n\t}\r\n\t$model->refresh();\r\n\treturn true;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.subresources.save\">pre.filter.model.subresources.save</a>\r\n```php\r\n$this->onRest('pre.filter.model.subresources.save', function($model, $subresource_name, $subresource_id) {\r\n\treturn [$model, $subresource_name, $subresource_id]; //Array [Object, String, Int]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.subresources.save\">post.filter.model.subresources.save</a>\r\n```php\r\n$this->onRest('post.filter.model.subresources.save', function($result)) {\r\n\treturn $result; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.delete\">model.delete</a>\r\n```php\r\n/**\r\n * model.delete\r\n *\r\n * Called whenever a model resource needs deleting\r\n *\r\n * @param (Object) (model) the model resource to be deleted\r\n */\r\n$this->onRest('model.delete', function($model) {\r\n\tif(!$model->delete()) {\r\n\t\tthrow new CHttpException(500, 'Could not delete model');\r\n\t}\r\n\treturn $model;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.delete\">pre.filter.model.delete</a>\r\n```php\r\n$this->onRest('pre.filter.model.delete', function($model) {\r\n\treturn $model; //Object\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.delete\">post.filter.model.delete</a>\r\n```php\r\n$this->onRest('post.filter.model.delete', function($result)) {\r\n\treturn $result; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n###<a name=\"model.subresource.delete\">model.subresource.delete</a>\r\n```php\r\n/**\r\n * model.subresource.delete\r\n *\r\n * Called whenever a subresource needs deleting\r\n *\r\n * @param (Object) (model) the owner of the sub-resource\r\n * @param (String) (subresource_name) the name of the subresource\r\n * @param (Mixed/Int) (subresource_id) the primary key of the subresource\r\n *\r\n * @return (Object) the updated model representing the owner of the sub-resource\r\n */\r\n$this->onRest('model.subresource.delete', function($model, $subresource_name, $subresource_id) {\r\n\tif(!$this->getSubresourceHelper()->deleteSubResource($model, $subresource_name, $subresource_id)) {\r\n\t\tthrow new CHttpException(500, 'Could not delete Sub-Resource');\r\n\t}\r\n\t$model->refresh();\r\n\treturn $model;\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.subresource.delete\">pre.filter.model.subresource.delete</a>\r\n```php\r\n$this->onRest('pre.filter.model.subresource.delete', function($model, $subresource_name, $subresource_id) {\r\n\treturn [$model, $subresource_name, $subresource_id]; //Array [Object, String, Int]\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.subresource.delete\">post.filter.model.subresource.delete</a>\r\n```php\r\n$this->onRest('post.filter.model.subresource.delete', function($result)) {\r\n\treturn $result; //Object\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.restricted.properties\">model.restricted.properties</a>\r\n```php\r\n/**\r\n * model.restricted.properties\r\n *\r\n * Called when determining which properties if any should be considered restricted\r\n * The default is [] (no restricted properties)\r\n *\r\n * @return (Array) list of restricted properties\r\n */\r\n$this->onRest('model.restricted.properties', function() {\r\n\treturn [];\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.restricted.properties\">pre.filter.model.restricted.properties</a>\r\n```php\r\n$this->onRest('pre.filter.model.restricted.properties', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.restricted.properties\">post.filter.model.restricted.properties</a>\r\n```php\r\n$this->onRest('post.filter.model.restricted.properties', function($result)) {\r\n\treturn $result; //Array\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.visible.properties\">model.visible.properties</a>\r\n```php\r\n/**\r\n * model.visible.properties\r\n *\r\n * Called when determining which properties if any should be considered visible\r\n * The default is [] (no hidden properties)\r\n *\r\n * @return (Array) list of visible properties\r\n */\r\n$this->onRest('model.visible.properties', function() {\r\n\treturn [];\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.visible.properties\">pre.filter.model.visible.properties</a>\r\n```php\r\n$this->onRest('pre.filter.model.visible.properties', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.visible.properties\">post.filter.model.visible.properties</a>\r\n```php\r\n$this->onRest('post.filter.model.visible.properties', function($result)) {\r\n\treturn $result; //Array\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n###<a name=\"model.hidden.properties\">model.hidden.properties</a>\r\n```php\r\n/**\r\n * model.hidden.properties\r\n *\r\n * Called when determining which properties if any should be considered hidden\r\n * The default is [] (no hidden properties)\r\n *\r\n * @return (Array) list of hidden properties\r\n */\r\n$this->onRest('model.hidden.properties', function() {\r\n\treturn [];\r\n});\r\n```\r\n\r\n####<a name=\"pre.filter.model.hidden.properties\">pre.filter.model.hidden.properties</a>\r\n```php\r\n$this->onRest('pre.filter.model.hidden.properties', function() {\r\n\t//No return\r\n});\r\n```\r\n\r\n####<a name=\"post.filter.model.hidden.properties\">post.filter.model.hidden.properties</a>\r\n```php\r\n$this->onRest('post.filter.model.hidden.properties', function($result)) {\r\n\treturn $result; //Array\r\n});\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n## Testing\r\nRunning the project's automated tests.\r\n\r\n### Unit Tests\r\n\r\n1. Make sure you that you have the correct database and database user in the test config \r\n(/WEB_ROOT/protected/extensions/starship/RestfullYii/tests/testConfig.php).\r\n2. % cd /WEB_ROOT/protected/extensions/starship/RestfullYii/tests\r\n3. % phpunit unit/\r\n\r\n## Contributors\r\n* [evan108108](https://github.com/evan108108)\r\n* [goliatone](https://github.com/goliatone)\r\n* [ubin](https://github.com/ubin)\r\n* [jlsalvador](https://github.com/jlsalvador)\r\n* [ericmcgill](https://github.com/ericmcgill)\r\n* [stianlik](https://github.com/stianlik)\r\n* [kachar](https://github.com/kachar)\r\n* [drLev](https://github.com/drLev)\r\n* [sheershoff](https://github.com/sheershoff)\r\n* [Arne-S](https://github.com/Arne-S)\r\n* [amesmoey](https://github.com/amesmoey)\r\n* [eligundry](https://github.com/eligundry)\r\n* [rominawnc](https://github.com/rominawnc)\r\n\r\n## License\r\nStarship / RestfullYii is released under the WTFPL license - http://sam.zoy.org/wtfpl/. This means that you can literally do whatever you want with this extension.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}